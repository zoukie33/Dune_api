#!/usr/bin/env node

/**
 * Module dependencies.
 */
process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';
var app = require('../app');
var debug = require('debug')('dune-api:server');
var fs = require('fs');

var http = require('http');
var https = require('https');

var credentials = {
  key: fs.readFileSync(__dirname + '/server.key'),
  cert: fs.readFileSync(__dirname + '/server.crt')
};

http.createServer(app).listen(80);
https.createServer(credentials, app).listen(443);

app.use(function(req, res, next) {
  if (!req.secure) {
    return res.redirect(['https://', req.get('Host'), req.url].join(''));
  }
  next();
});
